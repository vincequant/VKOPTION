# IB Portfolio Monitor - 本地到雲端使用指南

## 快速開始

### 步驟1: 啟動本地應用
```bash
cd "/Users/vk/Library/CloudStorage/Dropbox/Vkquantapp/IB倉位監控"
python app.py
```

應用會：
1. 自動連接TWS（如果可用）
2. 啟動本地服務器
3. 自動打開瀏覽器顯示IB倉位監控頁面

### 步驟2: 更新本地數據
在打開的頁面中：
1. 點擊右上角的「更新持倉」按鈕
2. 等待系統從TWS獲取最新倉位數據
3. 確認頁面顯示正確的持倉信息

### 步驟3: 配置雲端上傳
1. 點擊右上角的「配置雲端」按鈕（紅色）
2. 在彈出的配置對話框中填入：
   - **API URL**: `https://your-railway-app.railway.app/api/portfolio/upload`
   - **API Key**: 您的Railway API密鑰
   - **賬戶號碼**: 您的IB賬戶號碼
   - **啟用雲端上傳**: ✅ 勾選

3. 點擊「測試連接」確認配置正確
4. 點擊「保存配置」

### 步驟4: 一鍵上傳到雲端
配置完成後：
1. 按鈕會變成綠色的「上傳雲端」
2. 點擊按鈕一鍵同步到雲端
3. 等待上傳完成提示

### 步驟5: 查看雲端頁面
在Vercel前端URL查看與本地相同的頁面。

## 詳細功能說明

### 本地功能
- **TWS連接**: 自動連接Interactive Brokers TWS
- **實時數據**: 獲取真實的持倉和市場數據
- **本地存儲**: 數據保存在本地JSON文件
- **自動刷新**: 定期更新數據

### 雲端同步功能
- **一鍵上傳**: 將本地數據同步到Railway雲端
- **配置管理**: 保存雲端API配置
- **狀態指示**: 按鈕顏色顯示配置和上傳狀態
- **錯誤處理**: 詳細的錯誤提示和處理

### 按鈕狀態說明
- 🔴 **配置雲端** - 雲端未配置或已禁用
- 🟢 **上傳雲端** - 雲端已配置，可以上傳
- 🔄 **上傳中...** - 正在上傳數據
- ✅ **成功上傳 X 個持倉** - 上傳成功
- ❌ **上傳失敗** - 上傳出錯

## 故障排除

### TWS連接問題
1. 確保TWS正在運行
2. 檢查API設置已啟用
3. 確認端口7496（紙交易）或7497（實盤）

### 雲端上傳問題
1. 檢查Railway應用是否正在運行
2. 驗證API URL格式正確
3. 確認API Key有效
4. 檢查網絡連接

### 瀏覽器問題
1. 清除瀏覽器緩存
2. 檢查端口8080是否被占用
3. 嘗試手動訪問 http://localhost:8080

## 配置文件位置
- **雲端配置**: `cloud_upload_config.json`
- **本地數據**: `portfolio_data_enhanced.json`

## 常用操作
1. **更新本地數據**: 點擊「更新持倉」
2. **同步到雲端**: 點擊「上傳雲端」
3. **修改雲端配置**: 點擊按鈕打開配置對話框
4. **查看測試頁面**: 點擊「測試頁面」

## 完整流程示例
```
1. 啟動TWS → 2. 運行 python app.py → 3. 瀏覽器自動打開
    ↓
4. 點擊「更新持倉」→ 5. 確認數據顯示 → 6. 點擊「配置雲端」
    ↓
7. 填入配置信息 → 8. 測試連接 → 9. 保存配置
    ↓
10. 點擊「上傳雲端」→ 11. 等待上傳完成 → 12. 查看雲端頁面
```

現在您可以輕鬆地從本地TWS獲取數據，並一鍵同步到雲端！